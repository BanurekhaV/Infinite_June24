--second highest problems are solved using corelated sub query

select empname,salary from tblemployees order by salary desc
update tblemployees set salary = 7000 where empname = 'vijendra'

select e.Empname, e.salary from tblemployees e
where 2 =(select count(salary)from tblemployees e2 where e2.Salary >=e.salary)

-- in many cases corelated sub query can be replaced with inner join for better performance

--eg 1. Find all employees whose salary is greater than the average salary of that department

--with corelated sub query
select e1.Empid, e1.empname from tblemployees e1
where salary > (select avg(salary) from tblemployees e2 where e2.deptno = e1.deptno)

--with inner join
select e1.Empid, e1.empname from tblemployees e1 join 
                       (select deptno, avg(salary) as 'Dept Average' from tblemployees
					   group by deptno) as T on e1.DeptNo = T.DeptNo
					   where e1.Salary > t.[Dept Average]

--corelated sub query for updation
--eg 2. update salary for all employees, whose salary is minimum in that departement

update tblemployees set salary = 6000 where empid =108

update tblemployees set salary = Salary + 20 
from tblemployees t1 where Salary <=
                       (select min(t2.salary) from tblemployees t2 where t2.deptno = t1.DeptNo)

select empname, salary from tblemployees

--bulk insertion

create table dummy1(did int, dname varchar(10))

alter table dummy1 add daddress varchar(10)

update dummy1 set daddress = 'Infinite'

drop table dummy2
create table dummy2(id int, dummyname varchar(10),dphone varchar(5),dcity varchar(6),dsal float)

insert into dummy1 values(1,'A'),(2,'B'),(3,'C'),(4,'D')
select * from dummy1
select * from dummy2

-- source having more columns than destination
insert into dummy2(id, dummyname) select did,dname from dummy1 

--destination having more columns than source, then we need to specify 
--the column list for insertion
insert into dummy2(id, dummyname) select did,dname from dummy1 


--identity column
drop table sample1
create table Sample1
(S_id int identity(2,2),
sname varchar(5))

sp_help sample1

sp_help tblemployees

insert into sample1 values('BCOM')

select * from sample1
delete from sample1 where s_id=2

--drop vs truncate vs delete

create table test(tid int, tname char(5))
insert into test values(1,'g'),(2,'p'),(3,'o')
select * from test

drop table test
truncate table test

delete from test
where tid>1

begin tran
  delete from test
where tid>1
rollback

--hard delete vs soft delete
delete tbldepartment where deptno=1

update tblDepartment set deptno=0 where deptno=1  -- soft delete

alter table tblemployees
add remarks varchar(max)
select * from tblemployees
update tblemployees set remarks ='inactive' where empid=300

--case
create table casetable(cid int, cname varchar(20))

insert into casetable values(5, 'White'),(3,'Blue'),(2,'Green'),(4,'Red')

--Simple Case without else
select cid,cname,
 case cname
   when 'Red' then 'Danger'
   when 'Blue' then 'Primary'
   when 'Green' then 'Success'
 end as Remarks
  from casetable

 --case with else
 select cid,cname,
 case cname
   when 'Red' then 'Danger'
   when 'Blue' then 'Primary'
   when 'Green' then 'Success'
   else 'No Comments'
 end as 'Color Remarks'
  from casetable